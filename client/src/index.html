<!DOCTYPE html>
<html>
<title></title>
<head>
    <link rel="stylesheet" type="text/css" href="./css/indexStyle.css">
</head>
<body>
    <div class="limiter">
		<div class="container" >
			<div class="wrap-login">
				<form class="login-form" id="loginForm">
					<span class="title">Login</span>

					<div class="wrap-input">
						<span class="label-input">Email</span>
						<input id="email" class="input" type="text" name="email"  placeholder="Type your Email">
					</div>
					
					<div class="wrap-input">
						<span class="label-input">Password</span>
						<input id="password" class="input" type="password" name="password"  placeholder="Type your password">
					</div>
					<br>
					<input type="checkbox" name="rememberMe" id="rememberMe" value="Remember Me">Remember Me</input>
					<br><br>
					<p class="errors" id="errors">
					<div class="container-form-btn">
						<div class="wrap-form-btn">
							<div class="form-bgbtn"></div>
							<button class="form-btn" type="submit">Login</button>
						</div>
					</div>
					<br>
					<div class="signUp">
						<span class="txt1">Don't have an account? </span>
						<a href="register.html" class="txt2"> Sign Up</a>
					</div>
				</form>
			</div>
		</div>
	</div>
	<script>   
		var ans;
		const loginForm = document.getElementById('loginForm');
		let rememberMe = document.getElementById('rememberMe').checked;
	
		loginForm.addEventListener('submit', function(e){
			e.preventDefault();
			let isValidInput = validateUserInput();
			if(isValidInput) {
			fetch(`http://localhost:5000/login?email=${email}&password=${password}&rememberMe=${rememberMe}`, {
				method: 'post',
			 }) .then(response => response.text())
				.then(result => ans=result)
				.then(()=> handleResponse(ans))
				.catch(error => console.log('error', error));
			}
		});
			
		function handleResponse(ans){
			switch(ans) {
				case "NOT_EXISTS":
					document.getElementById('errors').innerHTML = "The details you entered does not match any account. Sign up for the account"
					break;

				case "INCORRECT":
					document.getElementById('errors').innerHTML = "User name or password incorrect"
					break;

				case "OK":
					location.href = "./private/homePage.html";
					break;
			}       
		}

		function validateUserInput() {
			var email = document.getElementById('email').value;
			var password = document.getElementById('password').value;
			if(email == 'admin' && password == 'admin'){
				return true;
			}

			let isValidEmail = (/\S+@\S+\.\S+/).test(email)
			if(!isValidEmail) {
				document.getElementById("errors").innerHTML += "<br>Wrong email format";
			}

			let isValidPassword = password.length > 5;
			if(!isValidPassword){
				document.getElementById("errors").innerHTML += "<br>password must contains at list 6 characters";
			}

			return isValidEmail && isValidPassword;
		}
		</script>
</body>
</html>